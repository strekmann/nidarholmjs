cache:
  paths:
    - node_modules/
    - .yarn

#default:
#  before_script:
#    - apt install build-essential

stages:
  - build

build:
  image: node:14-alpine
  stage: build
  script:
    - apk add --no-cache --virtual .build-dependencies make g++ gcc python
    - yarn install --frozen-lockfile --production
    - cp -r node_modules node_modules_production
    - yarn install --frozen-lockfile
    - yarn build-project
    - mv node_modules_production dist/node_modules
  artifacts:
    name: "$CI_COMMIT_REF_SLUG"
    paths:
      - dist/
  interruptible: true
