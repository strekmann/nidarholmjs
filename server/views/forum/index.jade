extends ../layouts/main

block content
  .row
    .columns.large-8.medium-10.large-centered.medium-centered
      #forum
        //
          Used by tests, also nice for non-js-peeps (rofl)
        for post in posts
          article.post
            header
              h1
                a(href="/forum/"+post.id)
                  = post.title
              .meta
                .row
                  .columns.small-9
                    span.byline
                      a(href="/users/" + post.creator._id)= post.creator.name
                    time.created(datetime=post.created)= post.created
              .content
                .row
                  .columns
                    != marked(post.mdtext)

  script#template(type="text/ractive")
    .row
      .columns.text-right
        i.fa.fa-file-o
        | &nbsp;
        a(on-click="toggleNew") Nytt innlegg

    | {{#expanded}}
    form.newpost(method="POST" on-submit="addPost" intro-outro='slide')
      h1 Nytt innlegg
      .row
        .columns
          label(for="title") Tittel
          input#title(name="title" type="text")
      .row
        .columns
          label(for="mdtext-ace") Innhold
          #mdtext
        .columns.show-for-large-up
          label(for="mdpreview") Forhåndsvisning
          #mdpreview
            | {{{marked(mdpreview)}}}
      .row
        .columns
          label(for="permissions") Rettigheter
          select#permissions.chosen-permissions(name="permissions" multiple data-placeholder="Velg hvem som skal få se innlegget")
            +permission_options(active_user.groups, active_user.friends)
      button.small Lagre
      button.small.secondary(type="reset" on-click="toggleNew") Avbryt
    | {{/expanded}}

    | {{#posts}}
    |   {{>post}}
    | {{/posts}}

    | {{^gotall}}
    .row
      .columns.text-center.dtborder
        a.getmore(on-click="fetchPosts") Hent flere innlegg
    | {{/gotall}}

    // {{>post}}
    article
      header
        h1
          a(href="/forum/{{_id}}") {{title}}
        .meta
          .row
            .columns.small-9
              span.byline
                a(href="/users/{{creator._id}}") {{creator.name}}
              time.created(datetime="{{isodate(created)}}") {{shortdate(created)}}
              | &nbsp;
              | {{#tags}}
              a(href="{{taglink(.)}}") {{.}}
              | {{/tags}}
            .columns.small-3.text-right.creator
              permissionicons(permissions="{{permissions}}")
              a(title="Slett innlegget" on-click="deletePost")
                i.fa.fa-trash-o

        .content
          .row
            .columns {{{marked(mdtext)}}}
    // {{/post}}

block javascript
  script
    | require('s7n').forum.forumView(
    != JSON.stringify(posts)
    | );
