extends ../layouts/main

block content
  section#files
    div.row
      div.small-12.columns
        h1 Upload file
        p= organization

        form.dropzone(action="/files/upload")
          .fallback
            input(type="file" name="file" multiple)

        #list
          each file in files
            .file(data-id=file.id)
              a(href="/files/" + file.id)= file.filename
              .meta
                = file.created
                if file.permissions.public
                  i.fa.fa-globe
                else if 'medlemmer' in file.permissions.groups
                  i.fa.fa-users
                else if !file.permissions.public && file.permissions.groups.length === 0 && file.permissions.users.length === 0
                  i.fa.fa-user
                a.edit(href='#')
                  i.fa.fa-edit
                i.fa.fa-trash-o

              .update(colspan="4")
                form.update_meta(method='post')
                  .row
                    .columns
                      label(for="filename") Filnavn
                      input#filename.filename(type="text" name="filename" placeholder="Filnavn" value="Filnavn 3")
                  .row
                    .columns
                      label(for="permissions") Vises for
                      select#permissions.chosen-permissions(name="permissions" data-placeholder="Velg rettigheter" multiple)
                        +permission_options(active_user.groups, active_user.friends)
                  .row
                    .columns
                      label(for="tags") Merkelapper
                      input#tags.tags(type="text" name="tags" placeholder="musikk,korps")

                  .row
                    .columns.text-right
                      button.secondary.reset(type="reset") Avbryt
                      button Lagre

  script#template(type="text/ractive")
    .row
      .columns
        h1 Upload file
        form#upload(action="/files/upload")
          | Dra filer hit, eller klikk for Ã¥ velge
          .fallback
            input(type="file" name="file" multiple)

        | {{#uploading_files}}
        .file(intro="fade")
          strong {{name}}
          .progress
            span.meter(style="width: {{uploading.progress}}%")
        | {{/uploading_files}}

        | {{#files}}
        .row
          .small-2.columns
            {{#is_image(.)}}
            img.th(src="{{path}}")
            {{/is_image}}
          .small-10.columns
            .file(outro="fade")
              a(href="/files/{{_id}}") {{filename}}
              .meta
                | {{created}}
                | {{#is_public(permissions)}}
                i.fa.fa-globe
                | {{/is_public}}
                | {{#is_for_members(this.data.active_organization.member_group, permissions)}}
                i.fa.fa-users
                | {{/is_for_group}}
                | {{#is_unpublished(permissions)}}
                i.fa.fa-user
                | {{/is_unpublished}}
        | {{/files}}

block javascript
  script
    | var ractive = require('s7n').files.fileListView(
    != JSON.stringify(files)
    | ,
    != JSON.stringify(active_user)
    | ,
    != JSON.stringify(organization)
    | );

  script.
    $('.chosen-permissions').chosen({width: '100%'});
