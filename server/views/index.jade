extends layouts/main

block content
  section#index
    .row
      .columns.medium-4.medium-push-8
        .show-for-medium-up
          if events
            #events
              h1 Neste aktiviteter
              ul.small-block-grid-1
                for event in events
                  li
                    h2
                      a.event(href="/events/"+event.id)= event.title
                    .meta
                      != daterange(event.start, event.end)

                      if event.start < moment.utc().add(10, 'days')
                        if event.location
                          br
                          = event.location
                        if event.mdtext
                          .content
                            != marked(event.mdtext)
                      else
                        if event.mdtext
                          .right
                            a(href="/events/"+event.id) …
                        if event.location
                          br
                          = event.location
              #more-events
                a(href="/events") Full aktivitetsliste

        #eventwrapper.hide-for-medium-up
          #eventscroller
            ul#next-events
              for event in events
                li
                  a.event(href="/events/"+event.id)
                    b= moment(event.start).format('Do MMM')
                    br
                    = event.title

      .medium-8.columns.medium-pull-4
        if active_user
          #projects
            for project in projects
              article.project
                header
                  h1
                    a(href="/"+project.year+"/"+project.tag)= project.title
                  .meta
                    .row
                      .columns
                        span.byline
                          if project.start
                            = shortdate(project.start)
                            | – 
                          = shortdate(project.end)
                    .row
                      .columns
                        if project.concerts
                          for concert in project.concerts
                            time.start(datetime=concert.start)= longdate(concert.start)
                            if concert.location
                              span.location= concert.location
                    .row
                      if project.conductors.length
                        .columns.medium-6
                          b Dirigent:
                          for conductor in project.conductors
                            |  
                            a(href="/users/"+conductor.username)= conductor.name
                      if project.managers.length
                        .columns.medium-6
                          b Prosjektleder:
                          for manager in project.managers
                            |  
                            a(href="/users/"+manager.username)= manager.name
                .row
                  .columns
                    .content
                      != marked(project.private_mdtext)
                    a(href="/"+project.year+"/"+project.tag) Mer


          hr
          h1 Nylig aktivitet
          ul#activities

        else
          if meta.description
            != marked(meta.description)

          #projects
            for project in projects
              article.project
                header
                  h1
                    a(href="/"+project.year+"/"+project.tag)= project.title
                  .meta
                    .row
                      .columns
                        for concert in project.concerts
                          time.start(datetime=concert.start)= longdate(concert.start)
                          if concert.location
                            span.location= concert.location

              .content
                .row
                  .columns
                    != marked(project.public_mdtext)

          #news
            for post in posts
              article.post
                header
                  h1
                    a(href='/forum/'+post._id)= post.title
                  .meta
                    .row
                      .columns
                        span.byline
                          a(href="/users/" + post.creator.username)= post.creator.name
                        time.created(datetime=post.created)= shortdate(post.created)
                        for tag in post.tags
                          if tag != news_tag
                            a(href="/forum/t/"+tag)
                              i.fa.fa-tag
                                | &nbsp;
                                = tag
              .content
                .row
                  .columns
                    != marked(post.mdtext)

  script#activity-template(type="text/ractive")
    | {{#activities}}
    li
      | {{#content_type == "upload"}}
      h1
        i.fa.fa-upload.fa-fw.left
        a(href='/files/{{content_ids.0}}')
          | {{title}}
        small
          | &emsp;  
          a(href="/{{.project.year}}/{{.project.tag}}") {{.project.title}}
      | {{#content.images.length}}
      .row
        .columns
          ul.small-block-grid-5
            | {{#content.images}}
            li
              a(href="/files/{{._id}}")
                img.th(src="{{.thumbnail_path}}" alt="")
            | {{/content.images}}
      | {{/content.images.length}}
      | {{#content.non_images.length}}
      .row
        .columns
          ul
            | {{#content.non_images}}
            li
              a(href="/files/{{._id}}") {{.filename}}
            | {{/content.non_images}}
      | {{/content.non_images.length}}
      | {{/content_type}}
      | {{#content_type == "forum"}}
      h1
        i.fa.fa-comments-o.fa-fw.left
        a(href='/forum/{{content_ids.0}}')
          | {{title}}
      .row
        .columns
          | {{{marked(content.snippet)}}}
      | {{/content_type}}
      .row
        .columns.contributors
          | {{#user_images}}
          span.image
            img(src="{{.image}}" alt="{{.name}}" title="{{.name}}")
            | {{#if .count > 1}}
            span {{.count}}
            | {{/if}}
          | {{/user_images}}
          .changes
            | {{#changes.length > 1}}
            span.updates
              | {{ changes.length - 1 }} oppdateringer
            | {{/changes}}
            span.tags
              | {{#tags}}
              | {{#.}}
              | {{#if content_type === "forum"}}
              a(href="/forum/t/{{.}}")
                i.fa.fa-tag
                | &nbsp;{{.}}
              | {{/if}}
              | {{#if content_type === "upload"}}
              a(href="/files/t/{{.}}")
                i.fa.fa-tag
                | &nbsp;{{.}}
              | {{/if}}
              | &nbsp;
              | {{/.}}
              | {{/tags}}
            br
            span.last
              | siste fra
              = " "
              a(href="/users/{{ last(changes).user.username }}") {{ last(changes).user.name }}
              = " "
              | {{ago(modified)}}

    | {{/activities}}

block javascript
  script
    | require('s7n').base.indexView(
    != JSON.stringify(activities)
    | );

    | $('.chosen-permissions').chosen();
    | var eventscroll = new IScroll('#eventwrapper', { eventPassthrough: true, scrollX: true, scrollY: false, mouseWheel: true });
