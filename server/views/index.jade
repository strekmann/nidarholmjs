extends layouts/main

block content
  section#index
    .row
      .columns.large-3.large-push-9
        .show-for-large-up
          if projects.length
            #next-projects
              h1 Kommende prosjekt
              ul.small-block-grid-1
                for project in projects
                  li
                    a.project(href="/" + project.year + "/" + project.tag)
                      if project.poster
                        img(src=project.poster.normal_path alt=project.title)
                        p
                          b= project.title
                          br
                          = shortdate(project.end)
                      else
                        p
                          b= project.title
                          br
                          = shortdate(project.end)
            hr

          if events
            #next-events
              h1 Kommende aktiviteter
              ul.small-block-grid-1
                for event in events
                  li
                    a.event(href="/events/"+event.id)
                      b= moment(event.start).format('Do MMMM')
                      br
                      = event.title
              #more-events
                a(href="/events") Full aktivitetsliste

        #eventwrapper.hide-for-large-up
          #eventscroller
            ul#next-events
              for event in events
                li
                  a.event(href="/events/"+event.id)
                    b= moment(event.start).format('Do MMM')
                    br
                    = event.title

      .large-9.columns.large-pull-3
        if active_user
          ul#activities

        else
          if meta.description
            != marked(meta.description)

          #projects
            for project in projects
              article.project
                header
                  h1
                    a(href="/"+project.year+"/"+project.tag)= project.title
                  .meta
                    .row
                      .columns
                        for concert in project.concerts
                          time.start(datetime=concert.start)= longdate(concert.start)
                          if concert.location
                            span.location= concert.location

              .content
                .row
                  .columns
                    != marked(project.public_mdtext)

          #news
            for post in posts
              article.post
                header
                  h1
                    a(href='/forum/'+post._id)= post.title
                  .meta
                    .row
                      .columns
                        span.byline
                          a(href="/users/" + post.creator.username)= post.creator.name
                        time.created(datetime=post.created)= shortdate(post.created)
                        for tag in post.tags
                          if tag != news_tag
                            a(href="/forum/t/"+tag)
                              i.fa.fa-tag
                                | &nbsp;
                                = tag
              .content
                .row
                  .columns
                    != marked(post.mdtext)

  script#activity-template(type="text/ractive")
    | {{#activities}}
    li
      | {{#content_type == "upload"}}
      h1
        i.fa.fa-upload.fa-fw.left
        a(href='/files/{{content_ids.0}}')
          | {{title}}
        small
          | &emsp;  
          a(href="/{{.project.year}}/{{.project.tag}}") {{.project.title}}
      | {{#content.images.length}}
      .row
        .columns
          ul.small-block-grid-5
            | {{#content.images}}
            li
              a(href="/files/{{._id}}")
                img.th(src="{{.thumbnail_path}}" alt="")
            | {{/content.images}}
      | {{/content.images.length}}
      | {{#content.non_images.length}}
      .row
        .columns
          ul
            | {{#content.non_images}}
            li
              a(href="/files/{{._id}}") {{.filename}}
            | {{/content.non_images}}
      | {{/content.non_images.length}}
      | {{/content_type}}
      | {{#content_type == "forum"}}
      h1
        i.fa.fa-comments-o.fa-fw.left
        a(href='/forum/{{content_ids.0}}')
          | {{title}}
      .row
        .columns
          | {{{marked(content.snippet)}}}
      | {{/content_type}}
      .row
        .columns.contributors
          | {{#user_images}}
          span.image
            img(src="{{.image}}" alt="{{.name}}" title="{{.name}}")
            | {{#if .count > 1}}
            span {{.count}}
            | {{/if}}
          | {{/user_images}}
          .changes
            | {{#changes.length > 1}}
            span.updates
              | {{ changes.length - 1 }} oppdateringer
            | {{/changes}}
            span.tags
              | {{#tags}}
              | {{#.}}
              | {{#if content_type === "forum"}}
              a(href="/forum/t/{{.}}")
                i.fa.fa-tag
                | &nbsp;{{.}}
              | {{/if}}
              | {{#if content_type === "upload"}}
              a(href="/files/t/{{.}}")
                i.fa.fa-tag
                | &nbsp;{{.}}
              | {{/if}}
              | &nbsp;
              | {{/.}}
              | {{/tags}}
            br
            span.last
              | siste fra
              = " "
              a(href="/users/{{ last(changes).user.username }}") {{ last(changes).user.name }}
              = " "
              | {{ago(modified)}}

    | {{/activities}}

block javascript
  script
    | require('s7n').base.indexView(
    != JSON.stringify(activities)
    | );

    | $('.chosen-permissions').chosen();
    | var eventscroll = new IScroll('#eventwrapper', { eventPassthrough: true, scrollX: true, scrollY: false, mouseWheel: true });
